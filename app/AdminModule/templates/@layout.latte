<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<meta name="robots" content="noindex,nofollow">

	<title>{ifset $title}{$title}{/ifset}{if $name != ''} &ndash; {$name}{/if} &ndash; Administration</title>

	<link rel="stylesheet" media="screen" href="{$basePath}/css/reset.css" type="text/css">
	<link rel="stylesheet" media="screen,projection,tv" href="{$basePath}/css/admin/screen.css" type="text/css">

	<link rel="shortcut icon" href="{$basePath}/favicon.ico" type="image/x-icon">

	<script type="text/javascript" src="{$jqueryLib}"></script>
	<script type="text/javascript" src="{$basePath}/js/netteForms.js"></script>
	<script type="text/javascript" src="{$basePath}/js/ajax.js"></script>
	<script type="text/javascript" src="{$basePath}/js/admin/createSlug.js"></script>
    <script type="text/javascript" src="{$basePath}/js/admin/tiny_mce/tiny_mce.js" ></script>
	<script type="text/javascript" src="{$basePath}/js/admin/epiceditor/js/epiceditor.min.js"></script>

	<script type="text/javascript" >
		$(document).ready(function(){
			tinyMCE.init({
				mode: "specific_textareas",
				editor_selector: "mceEditor",
				theme : "advanced"
			});

			var opts = {
				container: 'frm-postForm-content',
				basePath: {$basePath . '/js/admin/epiceditor'},
				clientSideStorage: false,
				localStorageName: 'epiceditor',
				parser: marked,
				file: {
					name: 'epiceditor',
					defaultContent: '',
					autoSave: 100
				},
				theme: {
					base:'/themes/base/epiceditor.css',
					preview:'/themes/preview/preview-dark.css',
					editor:'/themes/editor/epic-dark.css'
				},
				focusOnLoad: false,
				shortcut: {
					modifier: 18,
					fullscreen: 70,
					preview: 80,
					edit: 79
				}
			}

			var epicEditor = new EpicEditor(opts);
			epicEditor.load(function(){
				console.log('epicEditor was loaded.');
			});

			$('.use-markdown-syntax').change(function (){
				if($('.use-markdown-syntax').attr('checked')){
					tinyMCE.execCommand('mceFocus', false, 'frm-postForm-content');
					tinyMCE.execCommand('mceRemoveControl', false, 'frm-postForm-content');

					epicEditor.load(function(){
						console.log('epicEditor was loaded.');
					});
				}else{
					tinyMCE.execCommand('mceAddControl', false, 'frm-postForm-content');

					epicEditor.unload(function(){
						console.log('epicEditor was unloaded.');
					});
				}
			});

		});
	</script >
	{block head}{/block}
</head>

<body>
	<div id="header">

		<H1>{$name}</H1>

		{if $user->isLoggedIn() and count($menuItems)}
			<div id="navigation">
				<ul>
					<li n:foreach="$menuItems as $menuItem">
						<a n:href="{$menuItem->page}">{$menuItem->title}</a>
					</li>
				</ul>
			</div>
		{/if}

		<H2>{$presenter->name} | {$presenter->view}</H2>
	</div>

	<div id="main">

		{snippet flashMessages}
			<div n:foreach="$flashes as $flash" class="flash {$flash->type}">{$flash->message}</div>
		{/snippet}

		<div id="content">
			{include #content}
		</div>

	</div>

	{if $user->isLoggedIn()}
		<div id="footer">
			Logged in as <a n:href="User:edit $user->getId()">{$user->getIdentity()->email}</a> |
			<a n:href="User:password">Change password</a> |
			<a n:href="signOut!">Logout</a> |
			<a style="font-weight: bold;" n:href=":Front:Homepage:">Show web</a>
		</div>
	{/if}

</body>
</html>
